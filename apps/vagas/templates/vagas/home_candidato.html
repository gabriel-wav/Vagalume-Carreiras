{% extends 'base.html' %}
{% load static %}
{% block title %}Painel de Vagas{% endblock %}

{% block content %}

<div class="onboarding-container" id="onboarding-container">
    <h1 class="onboarding-title">
        Bem-vindo(a), {{ user.first_name|default:user.username }}!
    </h1>
    <p class="onboarding-subtitle">
        Vamos preparar seu perfil para que as melhores oportunidades encontrem você.
    </p>
    
    <div class="progress-bar-wrapper">
        <div class="progress-bar-fill" id="progress-bar-fill"></div>
    </div>
    <p class="progress-text" id="progress-text">10%</p>
    
    <button type="button" class="btn-submit-green" id="btn-vamos-comecar">
        Vamos começar
    </button>
</div>

<div class="onboarding-container" id="onboarding-step-2">
    <h1 class="onboarding-title">
        Resumo Profissional
    </h1>
    <p class="onboarding-subtitle">
        Adicione um resumo sobre sua carreira para que os recrutadores te conheçam melhor.
    </p>

    <form action="{% url 'salvar_resumo' %}" method="POST" class="onboarding-form">
        {% csrf_token %}
        <textarea name="resumo" class="onboarding-textarea" placeholder="Escreva sobre suas experiências, habilidades e objetivos..."></textarea>
        <button type="submit" class="btn-submit-green">Continuar</button>
    </form>

    <div class="progress-bar-wrapper">
        <div class="progress-bar-fill" style="width: 30%;"></div>
    </div>
    <p class="progress-text">30%</p>
</div>

<div class="vagas-container" id="vagas-container">
    <div class="container-header">
        <h1>Vagas Abertas</h1>
        <p>Encontre sua próxima oportunidade.</p>
    </div>
    {% if messages %}
        <ul class="messages">
            {% for message in messages %}
                <li class="{{ message.tags }}">{{ message }}</li>
            {% endfor %}
        </ul>
    {% endif %}
    </div>


<style>
    /* Esconde os blocos por padrão */
    .onboarding-container,
    .vagas-container {
        display: none;
        opacity: 0;
        visibility: hidden;
    }

    /* Classe que o JS usa para mostrar o bloco ativo */
    .container-ativo {
        display: block;
        opacity: 0;
        visibility: visible;
        animation: fadeIn 0.5s ease-out forwards;
    }

    /* Animação de entrada */
    @keyframes fadeIn {
        to { opacity: 1; }
    }

    /* Animação de saída (Fade Out/Down) */
    @keyframes fadeOutDown {
        from { opacity: 1; transform: translateY(0); }
        to { opacity: 0; transform: translateY(50px); visibility: hidden; }
    }

    /* Animação de entrada (Fade In/Up) */
    @keyframes fadeInUp {
        from { opacity: 0; transform: translateY(50px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .container-ativo.fade-out {
        animation: fadeOutDown 0.5s ease-in forwards;
    }
    
    .container-ativo.fade-in {
        animation: fadeInUp 0.5s ease-out forwards;
    }

    /* (O resto do seu CSS de .onboarding-title, .progress-bar, .vaga-card, etc. 
       pode ser colado aqui ou movido para o style.css) */
    .onboarding-container { text-align: center; max-width: 600px; margin: 40px auto; padding: 30px; background-color: #161B22; border: 1px solid #30363d; border-radius: 8px; }
    .onboarding-title { font-family: 'Plus Jakarta Sans', sans-serif; font-weight: 800; font-size: 2.2rem; color: #FFFFFF; margin-bottom: 10px; }
    .onboarding-subtitle { font-size: 1.1rem; color: #8b949e; margin-bottom: 30px; }
    .progress-bar-wrapper { width: 100%; height: 10px; background-color: #0D1B2A; border: 1px solid #30363d; border-radius: 5px; overflow: hidden; }
    .progress-bar-fill { width: 0%; height: 100%; background-color: #BEF264; border-radius: 5px; transition: width 1.5s ease-out; }
    .progress-text { color: #8b949e; font-size: 0.9rem; margin-top: 5px; margin-bottom: 30px; }
    .btn-submit-green { display: inline-block; text-decoration: none; width: auto; padding: 12px 30px; }
    .vagas-container { max-width: 900px; margin: auto; }
    .container-header { text-align: center; margin-bottom: 30px; }
    .container-header h1 { font-size: 2.5rem; }
    .container-header p { font-size: 1.1rem; color: #8b949e; }
    .vaga-card { background: #161B22; border: 1px solid #30363d; padding: 20px; margin-bottom: 15px; border-radius: 8px; }
    .vaga-card h3 { color: #fff; margin-top: 0; }
    .vaga-empresa { font-weight: bold; color: #8b949e; }
    .btn-detalhes { background: #007bff; color: white; padding: 8px 12px; text-decoration: none; border-radius: 5px; border: none; cursor: pointer; font-size: 0.9rem; }
    .btn-detalhes:hover { background: #0056b3; }
    .messages { list-style-type: none; padding: 0; }
    .messages li { padding: 10px; margin-bottom: 15px; border-radius: 5px; }
    .messages .success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
    .messages .warning { background-color: #fff3cd; color: #856404; border: 1px solid #ffeeba; }
    .messages .error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    .onboarding-form { width: 100%; margin-bottom: 20px; }
    .onboarding-textarea { width: 100%; min-height: 150px; background-color: #0d1117; border: 1px solid #30363d; color: #c9d1d9; padding: 12px 15px; border-radius: 5px; font-size: 1rem; font-family: 'Plus Jakarta Sans', sans-serif; margin-bottom: 20px; }
    .onboarding-textarea::placeholder { color: #8b949e; }
    .onboarding-textarea:focus { border-color: #58a6ff; outline: none; box-shadow: 0 0 0 3px rgba(88,166,255,0.3); }

</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Pega os elementos da página
    const vagasContainer = document.getElementById('vagas-container');
    const step1Container = document.getElementById('onboarding-container');
    const step2Container = document.getElementById('onboarding-step-2');
    const btnVamosComecar = document.getElementById('btn-vamos-comecar');

    // --- 1. LÓGICA DE EXIBIÇÃO INICIAL ---
    let isFirstLogin = false;
    {% if messages %}
        {% for message in messages %}
            {% if 'FIRST_LOGIN' in message.tags %}
                isFirstLogin = true;
            {% endif %}
        {% endfor %}
    {% endif %}

    if (isFirstLogin) {
        // Se for o primeiro login, mostra o Passo 1
        step1Container.classList.add('container-ativo');
        
        setTimeout(() => {
            document.getElementById('progress-bar-fill').style.width = '10%';
            document.getElementById('progress-text').innerText = '10%';
        }, 500); 
    } else {
        // Se NÃO for o primeiro login, mostra a lista de vagas
        vagasContainer.classList.add('container-ativo');
    }

    // --- 2. LÓGICA DA TRANSIÇÃO (CORRIGIDA) ---
    if (btnVamosComecar) {
        btnVamosComecar.addEventListener('click', function(event) {
            event.preventDefault(); // Impede o link de navegar

            // 1. Aplica a animação "fade-out" no Bloco 1
            step1Container.classList.add('fade-out');

            // 2. Espera a animação do Bloco 1 terminar (500ms)
            setTimeout(() => {
                
                // 3. Espera o "intervalo" de 1 segundo (1000ms) que você pediu
                setTimeout(() => {
                    
                    // 4. Aplica a animação "fade-in" no Bloco 2
                    step2Container.classList.add('container-ativo', 'fade-in'); 

                    // 5. Anima a barra de progresso do Bloco 2
                    setTimeout(() => {
                        document.getElementById('progress-bar-fill-2').style.width = '30%';
                        document.getElementById('progress-text-2').innerText = '30%';
                    }, 500); // Meio segundo de delay para a barra

                }, 1000); // O intervalo de 1 segundo

            }, 500); // Tempo da animação fade-out
        });
    }
});
</script>
{% endblock %}